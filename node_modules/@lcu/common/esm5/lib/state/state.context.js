import { __assign, __awaiter, __extends, __generator } from "tslib";
import { ObservableContextService } from '../api/observable-context/observable-context.service';
import { Subject, BehaviorSubject, } from 'rxjs';
import { RealTimeConnection } from './../api/real-time/real-time.connection';
import { LCUServiceSettings } from '../api/lcu-service-settings';
import { HttpClient } from '@angular/common/http';
//  TODO:  Need to manage reconnection to hub scenarios here
var StateContext = /** @class */ (function (_super) {
    __extends(StateContext, _super);
    //  Constructors
    function StateContext(injector) {
        var _this = _super.call(this) || this;
        _this.injector = injector;
        _this.connectedToState = new BehaviorSubject({
            Code: -1,
            Message: 'Initialized',
        });
        _this.ConnectedToState = _this.connectedToState.asObservable();
        _this.http = injector.get(HttpClient);
        _this.ReconnectionAttempt = new Subject();
        _this.Settings = injector.get(LCUServiceSettings);
        var rtUrl = _this.buildHubUrl('');
        var actionUrl = _this.loadActionUrl('');
        _this.rt = new RealTimeConnection(_this.http, rtUrl, actionUrl);
        _this.rt.ReconnectionAttempt.subscribe(function (val) {
            _this.ReconnectionAttempt.next(val);
        });
        _this.setup();
        return _this;
    }
    //  API Methods
    StateContext.prototype.Execute = function (action) {
        return this.executeAction(action);
    };
    StateContext.prototype.$Refresh = function (args) {
        if (args === void 0) { args = {}; }
        this.Execute({
            Arguments: args,
            Type: 'Refresh',
        });
    };
    StateContext.prototype.Start = function (shouldUpdate) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                if (!this.startSub) {
                    this.startSub = this.rt.Started.subscribe(function () { return __awaiter(_this, void 0, void 0, function () {
                        var groupName;
                        return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0: return [4 /*yield*/, this.connectToState(shouldUpdate)];
                                case 1:
                                    groupName = _a.sent();
                                    this.setupReceiveState(groupName);
                                    this.connectedToState.next({ Code: 0, Message: 'Success' });
                                    this.callRefresh();
                                    return [2 /*return*/];
                            }
                        });
                    }); });
                    this.rt.Start();
                }
                return [2 /*return*/];
            });
        });
    };
    //  Helpers
    StateContext.prototype.buildActionUrl = function (urlRoot) {
        var url = this.loadActionUrl(urlRoot);
        return url;
    };
    StateContext.prototype.buildHubUrl = function (urlRoot) {
        var url = this.loadHubUrl(urlRoot);
        return url;
    };
    StateContext.prototype.callRefresh = function () {
        this.$Refresh();
    };
    StateContext.prototype.connectToState = function (shouldUpdate) {
        return __awaiter(this, void 0, void 0, function () {
            var stateKey, stateName, env;
            var _this = this;
            return __generator(this, function (_a) {
                stateKey = this.loadStateKey();
                stateName = this.loadStateName();
                env = this.loadEnvironment();
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        _this.rt
                            .InvokeAction('ConnectToState', _this.loadHeaders(), {
                            ShouldSend: shouldUpdate,
                            Key: stateKey,
                            State: stateName,
                            Environment: env,
                        })
                            .subscribe({
                            next: function (req) {
                                if ((req.body.status && req.body.status.code === 0) || (req.body.Status && req.body.Status.Code === 0)) {
                                    resolve(req.body.groupName);
                                }
                                else {
                                    reject(req.body.status
                                        ? req.body.status.message
                                        : 'Unknown issue connecting to state.');
                                }
                            },
                            error: function (err) { return reject(err); },
                        });
                    })];
            });
        });
    };
    StateContext.prototype.defaultValue = function () {
        return {};
    };
    StateContext.prototype.executeAction = function (action) {
        return __awaiter(this, void 0, void 0, function () {
            var stateKey, stateName;
            var _this = this;
            return __generator(this, function (_a) {
                stateKey = this.loadStateKey();
                stateName = this.loadStateName();
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        return _this.rt
                            .InvokeAction(action.Type, _this.loadHeaders(), __assign(__assign({}, action), { Key: stateKey, State: stateName }))
                            .subscribe({
                            next: function (req) {
                                resolve(req);
                            },
                            error: function (err) { return reject(err); }
                        });
                    })];
            });
        });
    };
    StateContext.prototype.loadActionPath = function () {
        var actionRoot = this.loadStateActionRoot();
        return "" + actionRoot; // ?lcu-app-id=${this.Settings.AppConfig.ID}&lcu-app-ent-lookup=${this.Settings.AppConfig.EnterpriseLookup}`;
    };
    StateContext.prototype.loadActionUrl = function (urlRoot) {
        var apiRoot = this.Settings ? this.Settings.APIRoot || '' : '';
        var actionPath = this.loadActionPath();
        return "" + apiRoot + (urlRoot || '') + actionPath;
    };
    StateContext.prototype.loadEnvironment = function () {
        var env = this.Settings.State
            ? this.Settings.State.Environment
            : null;
        if (!env) {
            env = '';
        }
        return env;
    };
    StateContext.prototype.loadHeaders = function () {
        return {
            'lcu-ent-lookup': this.Settings.Application.EnterpriseLookup,
            'lcu-hub-name': this.loadStateName(),
            'lcu-state-key': this.loadStateKey(),
            'lcu-environment': this.loadEnvironment(),
            'lcu-username-mock': this.loadUsernameMock(),
        };
    };
    StateContext.prototype.loadHubPath = function () {
        var stateRoot = this.loadStateRoot();
        var env = this.loadEnvironment();
        var unmock = this.loadUsernameMock();
        return stateRoot + "?lcu-app-ent-lookup=" + this.Settings.Application.EnterpriseLookup + "&lcu-environment=" + env + "&lcu-username-mock=" + unmock;
    };
    StateContext.prototype.loadHubUrl = function (urlRoot) {
        var apiRoot = this.Settings ? this.Settings.APIRoot || '' : '';
        var hubPath = this.loadHubPath();
        return "" + apiRoot + (urlRoot || '') + hubPath;
    };
    StateContext.prototype.loadStateRoot = function () {
        var stateRoot = this.Settings.State && this.Settings.State.Root !== undefined
            ? this.Settings.State.Root
            : '';
        return stateRoot + "/" + this.loadStateName();
    };
    StateContext.prototype.loadStateActionRoot = function () {
        var stateActinRoot = this.Settings.State &&
            this.Settings.State.ActionRoot !== undefined
            ? this.Settings.State.ActionRoot
            : '';
        return stateActinRoot + "/" + this.loadStateName();
    };
    StateContext.prototype.loadUsernameMock = function () {
        return this.Settings.State && this.Settings.State.UsernameMock
            ? this.Settings.State.UsernameMock
            : '';
    };
    StateContext.prototype.setup = function () {
        this.Start(false).then();
    };
    StateContext.prototype.setupReceiveState = function (groupName) {
        var _this = this;
        this.rt.RegisterHandler("ReceiveState=>" + groupName).subscribe(function (req) {
            console.log("Handled state from " + groupName);
            _this.subject.next(req);
        });
    };
    return StateContext;
}(ObservableContextService));
export { StateContext };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGUuY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BsY3UvY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3N0YXRlL3N0YXRlLmNvbnRleHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBR2hHLE9BQU8sRUFDTCxPQUFPLEVBR1AsZUFBZSxHQUVoQixNQUFNLE1BQU0sQ0FBQztBQUNkLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxVQUFVLEVBQWdCLE1BQU0sc0JBQXNCLENBQUM7QUFHaEUsNERBQTREO0FBRTVEO0lBQThDLGdDQUEyQjtJQW1CdkUsZ0JBQWdCO0lBQ2hCLHNCQUFzQixRQUFrQjtRQUF4QyxZQUNFLGlCQUFPLFNBMEJSO1FBM0JxQixjQUFRLEdBQVIsUUFBUSxDQUFVO1FBR3RDLEtBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLGVBQWUsQ0FBaUI7WUFDMUQsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUNSLE9BQU8sRUFBRSxhQUFhO1NBQ3ZCLENBQUMsQ0FBQztRQUVILEtBQUksQ0FBQyxnQkFBZ0IsR0FBRyxLQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLENBQUM7UUFFN0QsS0FBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXJDLEtBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBRWxELEtBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBRWpELElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFbkMsSUFBTSxTQUFTLEdBQUcs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LENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxVQUFVO1lBQ2hDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFFVCxPQUFVLGNBQWMsU0FBSSxJQUFJLENBQUMsYUFBYSxFQUFJLENBQUM7SUFDckQsQ0FBQztJQUVTLHVDQUFnQixHQUExQjtRQUNFLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsWUFBWTtZQUM1RCxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsWUFBWTtZQUNsQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ1QsQ0FBQztJQUVTLDRCQUFLLEdBQWY7UUFDRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFFUyx3Q0FBaUIsR0FBM0IsVUFBNEIsU0FBaUI7UUFBN0MsaUJBTUM7UUFMQyxJQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxtQkFBaUIsU0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLFVBQUMsR0FBRztZQUNsRSxPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUFzQixTQUFXLENBQUMsQ0FBQztZQUUvQyxLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDSCxtQkFBQztBQUFELENBQUMsQUF0UEQsQ0FBOEMsd0JBQXdCLEdBc1ByRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHNpZ25hbFIgZnJvbSAnQGFzcG5ldC9zaWduYWxyJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZUNvbnRleHRTZXJ2aWNlIH0gZnJvbSAnLi4vYXBpL29ic2VydmFibGUtY29udGV4dC9vYnNlcnZhYmxlLWNvbnRleHQuc2VydmljZSc7XHJcbmltcG9ydCB7IFN0YXRlQWN0aW9uIH0gZnJvbSAnLi9zdGF0ZS1hY3Rpb24ubW9kZWwnO1xyXG5pbXBvcnQgeyBJbmplY3RvciwgRXZlbnRFbWl0dGVyLCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtcclxuICBTdWJqZWN0LFxyXG4gIFN1YnNjcmlwdGlvbixcclxuICBmb3JrSm9pbixcclxuICBCZWhhdmlvclN1YmplY3QsXHJcbiAgT2JzZXJ2YWJsZSxcclxufSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgUmVhbFRpbWVDb25uZWN0aW9uIH0gZnJvbSAnLi8uLi9hcGkvcmVhbC10aW1lL3JlYWwtdGltZS5jb25uZWN0aW9uJztcclxuaW1wb3J0IHsgTENVU2VydmljZVNldHRpbmdzIH0gZnJvbSAnLi4vYXBpL2xjdS1zZXJ2aWNlLXNldHRpbmdzJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBTdGF0dXMgfSBmcm9tICcuLi9zdGF0dXMnO1xyXG5cclxuLy8gIFRPRE86ICBOZWVkIHRvIG1hbmFnZSByZWNvbm5lY3Rpb24gdG8gaHViIHNjZW5hcmlvcyBoZXJlXHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgU3RhdGVDb250ZXh0PFQ+IGV4dGVuZHMgT2JzZXJ2YWJsZUNvbnRleHRTZXJ2aWNlPFQ+IHtcclxuICAvLyAgRmllbGRzXHJcbiAgcHJvdGVjdGVkIGNvbm5lY3RlZFRvU3RhdGU6IEJlaGF2aW9yU3ViamVjdDxTdGF0dXM+O1xyXG5cclxuICBwcm90ZWN0ZWQgZ3JvdXBOYW1lOiBzdHJpbmc7XHJcblxyXG4gIHByb3RlY3RlZCBodHRwOiBIdHRwQ2xpZW50O1xyXG5cclxuICBwcm90ZWN0ZWQgcnQ6IFJlYWxUaW1lQ29ubmVjdGlvbjtcclxuXHJcbiAgcHJvdGVjdGVkIHN0YXJ0U3ViOiBTdWJzY3JpcHRpb247XHJcblxyXG4gIC8vICBQcm9wZXJ0aWVzXHJcbiAgcHVibGljIENvbm5lY3RlZFRvU3RhdGU6IE9ic2VydmFibGU8U3RhdHVzPjtcclxuXHJcbiAgcHVibGljIFJlY29ubmVjdGlvbkF0dGVtcHQ6IFN1YmplY3Q8Ym9vbGVhbj47XHJcblxyXG4gIHB1YmxpYyBTZXR0aW5nczogTENVU2VydmljZVNldHRpbmdzO1xyXG5cclxuICAvLyAgQ29uc3RydWN0b3JzXHJcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLmNvbm5lY3RlZFRvU3RhdGUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFN0YXR1cz4oPFN0YXR1cz57XHJcbiAgICAgIENvZGU6IC0xLFxyXG4gICAgICBNZXNzYWdlOiAnSW5pdGlhbGl6ZWQnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5Db25uZWN0ZWRUb1N0YXRlID0gdGhpcy5jb25uZWN0ZWRUb1N0YXRlLmFzT2JzZXJ2YWJsZSgpO1xyXG5cclxuICAgIHRoaXMuaHR0cCA9IGluamVjdG9yLmdldChIdHRwQ2xpZW50KTtcclxuXHJcbiAgICB0aGlzLlJlY29ubmVjdGlvbkF0dGVtcHQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xyXG5cclxuICAgIHRoaXMuU2V0dGluZ3MgPSBpbmplY3Rvci5nZXQoTENVU2VydmljZVNldHRpbmdzKTtcclxuXHJcbiAgICBjb25zdCBydFVybCA9IHRoaXMuYnVpbGRIdWJVcmwoJycpO1xyXG5cclxuICAgIGNvbnN0IGFjdGlvblVybCA9IHRoaXMubG9hZEFjdGlvblVybCgnJyk7XHJcblxyXG4gICAgdGhpcy5ydCA9IG5ldyBSZWFsVGltZUNvbm5lY3Rpb24odGhpcy5odHRwLCBydFVybCwgYWN0aW9uVXJsKTtcclxuXHJcbiAgICB0aGlzLnJ0LlJlY29ubmVjdGlvbkF0dGVtcHQuc3Vic2NyaWJlKCh2YWw6IGJvb2xlYW4pID0+IHtcclxuICAgICAgdGhpcy5SZWNvbm5lY3Rpb25BdHRlbXB0Lm5leHQodmFsKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuc2V0dXAoKTtcclxuICB9XHJcblxyXG4gIC8vICBBUEkgTWV0aG9kc1xyXG4gIHB1YmxpYyBFeGVjdXRlKGFjdGlvbjogU3RhdGVBY3Rpb24pIHtcclxuICAgIHJldHVybiB0aGlzLmV4ZWN1dGVBY3Rpb24oYWN0aW9uKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyAkUmVmcmVzaChhcmdzOiBhbnkgPSB7fSkge1xyXG4gICAgdGhpcy5FeGVjdXRlKHtcclxuICAgICAgQXJndW1lbnRzOiBhcmdzLFxyXG4gICAgICBUeXBlOiAnUmVmcmVzaCcsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBTdGFydChzaG91bGRVcGRhdGU6IGJvb2xlYW4pIHtcclxuICAgIGlmICghdGhpcy5zdGFydFN1Yikge1xyXG4gICAgICB0aGlzLnN0YXJ0U3ViID0gdGhpcy5ydC5TdGFydGVkLnN1YnNjcmliZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZ3JvdXBOYW1lID0gYXdhaXQgdGhpcy5jb25uZWN0VG9TdGF0ZShzaG91bGRVcGRhdGUpO1xyXG5cclxuICAgICAgICB0aGlzLnNldHVwUmVjZWl2ZVN0YXRlKGdyb3VwTmFtZSk7XHJcblxyXG4gICAgICAgIHRoaXMuY29ubmVjdGVkVG9TdGF0ZS5uZXh0KDxTdGF0dXM+eyBDb2RlOiAwLCBNZXNzYWdlOiAnU3VjY2VzcycgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuY2FsbFJlZnJlc2goKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLnJ0LlN0YXJ0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyAgSGVscGVyc1xyXG4gIHByb3RlY3RlZCBidWlsZEFjdGlvblVybCh1cmxSb290OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHVybCA9IHRoaXMubG9hZEFjdGlvblVybCh1cmxSb290KTtcclxuXHJcbiAgICByZXR1cm4gdXJsO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGJ1aWxkSHViVXJsKHVybFJvb3Q6IHN0cmluZykge1xyXG4gICAgY29uc3QgdXJsID0gdGhpcy5sb2FkSHViVXJsKHVybFJvb3QpO1xyXG5cclxuICAgIHJldHVybiB1cmw7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgY2FsbFJlZnJlc2goKSB7XHJcbiAgICB0aGlzLiRSZWZyZXNoKCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgYXN5bmMgY29ubmVjdFRvU3RhdGUoc2hvdWxkVXBkYXRlOiBib29sZWFuKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGNvbnN0IHN0YXRlS2V5ID0gdGhpcy5sb2FkU3RhdGVLZXkoKTtcclxuIFxyXG4gICAgY29uc3Qgc3RhdGVOYW1lID0gdGhpcy5sb2FkU3RhdGVOYW1lKCk7XHJcbiBcclxuICAgIGNvbnN0IGVudiA9IHRoaXMubG9hZEVudmlyb25tZW50KCk7XHJcbiBcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5ydFxyXG4gICAgICAgIC5JbnZva2VBY3Rpb24oJ0Nvbm5lY3RUb1N0YXRlJywgdGhpcy5sb2FkSGVhZGVycygpLCB7XHJcbiAgICAgICAgICBTaG91bGRTZW5kOiBzaG91bGRVcGRhdGUsXHJcbiAgICAgICAgICBLZXk6IHN0YXRlS2V5LFxyXG4gICAgICAgICAgU3RhdGU6IHN0YXRlTmFtZSxcclxuICAgICAgICAgIEVudmlyb25tZW50OiBlbnYsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3Vic2NyaWJlKHtcclxuICAgICAgICAgIG5leHQ6IChyZXE6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICgocmVxLmJvZHkuc3RhdHVzICYmIHJlcS5ib2R5LnN0YXR1cy5jb2RlID09PSAwKSB8fCAocmVxLmJvZHkuU3RhdHVzICYmIHJlcS5ib2R5LlN0YXR1cy5Db2RlID09PSAwKSkge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUocmVxLmJvZHkuZ3JvdXBOYW1lKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWplY3QoXHJcbiAgICAgICAgICAgICAgICByZXEuYm9keS5zdGF0dXNcclxuICAgICAgICAgICAgICAgICAgPyByZXEuYm9keS5zdGF0dXMubWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgICA6ICdVbmtub3duIGlzc3VlIGNvbm5lY3RpbmcgdG8gc3RhdGUuJ1xyXG4gICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvcjogKGVycikgPT4gcmVqZWN0KGVyciksXHJcbiAgICAgICAgICAvLyBjb21wbGV0ZTogKCkgPT4gY29uc29sZS5sb2coJ09ic2VydmVyIGdvdCBhIGNvbXBsZXRlIG5vdGlmaWNhdGlvbicpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZGVmYXVsdFZhbHVlKCk6IFQge1xyXG4gICAgcmV0dXJuIDxUPnt9O1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGFzeW5jIGV4ZWN1dGVBY3Rpb24oYWN0aW9uOiBTdGF0ZUFjdGlvbikge1xyXG4gICAgY29uc3Qgc3RhdGVLZXkgPSB0aGlzLmxvYWRTdGF0ZUtleSgpO1xyXG4gXHJcbiAgICBjb25zdCBzdGF0ZU5hbWUgPSB0aGlzLmxvYWRTdGF0ZU5hbWUoKTtcclxuIFxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPG9iamVjdD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5ydFxyXG4gICAgICAgIC5JbnZva2VBY3Rpb24oYWN0aW9uLlR5cGUsIHRoaXMubG9hZEhlYWRlcnMoKSwge1xyXG4gICAgICAgICAgLi4uYWN0aW9uLFxyXG4gICAgICAgICAgS2V5OiBzdGF0ZUtleSxcclxuICAgICAgICAgIFN0YXRlOiBzdGF0ZU5hbWUsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc3Vic2NyaWJlKHtcclxuICAgICAgICAgIG5leHQ6IChyZXE6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVxKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvcjogKGVycikgPT4gcmVqZWN0KGVycilcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGxvYWRBY3Rpb25QYXRoKCkge1xyXG4gICAgY29uc3QgYWN0aW9uUm9vdCA9IHRoaXMubG9hZFN0YXRlQWN0aW9uUm9vdCgpO1xyXG5cclxuICAgIHJldHVybiBgJHthY3Rpb25Sb290fWA7IC8vID9sY3UtYXBwLWlkPSR7dGhpcy5TZXR0aW5ncy5BcHBDb25maWcuSUR9JmxjdS1hcHAtZW50LWxvb2t1cD0ke3RoaXMuU2V0dGluZ3MuQXBwQ29uZmlnLkVudGVycHJpc2VMb29rdXB9YDtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBsb2FkQWN0aW9uVXJsKHVybFJvb3Q6IHN0cmluZykge1xyXG4gICAgY29uc3QgYXBpUm9vdCA9IHRoaXMuU2V0dGluZ3MgPyB0aGlzLlNldHRpbmdzLkFQSVJvb3QgfHwgJycgOiAnJztcclxuXHJcbiAgICBjb25zdCBhY3Rpb25QYXRoID0gdGhpcy5sb2FkQWN0aW9uUGF0aCgpO1xyXG5cclxuICAgIHJldHVybiBgJHthcGlSb290fSR7dXJsUm9vdCB8fCAnJ30ke2FjdGlvblBhdGh9YDtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBsb2FkRW52aXJvbm1lbnQoKSB7XHJcbiAgICBsZXQgZW52ID0gdGhpcy5TZXR0aW5ncy5TdGF0ZVxyXG4gICAgICA/IHRoaXMuU2V0dGluZ3MuU3RhdGUuRW52aXJvbm1lbnRcclxuICAgICAgOiBudWxsO1xyXG5cclxuICAgIGlmICghZW52KSB7XHJcbiAgICAgIGVudiA9ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBlbnY7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgbG9hZEhlYWRlcnMoKTogeyBbaGVhZGVyOiBzdHJpbmddOiBzdHJpbmcgfCBzdHJpbmdbXSB9IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICdsY3UtZW50LWxvb2t1cCc6IHRoaXMuU2V0dGluZ3MuQXBwbGljYXRpb24uRW50ZXJwcmlzZUxvb2t1cCxcclxuICAgICAgJ2xjdS1odWItbmFtZSc6IHRoaXMubG9hZFN0YXRlTmFtZSgpLFxyXG4gICAgICAnbGN1LXN0YXRlLWtleSc6IHRoaXMubG9hZFN0YXRlS2V5KCksXHJcbiAgICAgICdsY3UtZW52aXJvbm1lbnQnOiB0aGlzLmxvYWRFbnZpcm9ubWVudCgpLFxyXG4gICAgICAnbGN1LXVzZXJuYW1lLW1vY2snOiB0aGlzLmxvYWRVc2VybmFtZU1vY2soKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgbG9hZEh1YlBhdGgoKSB7XHJcbiAgICBjb25zdCBzdGF0ZVJvb3QgPSB0aGlzLmxvYWRTdGF0ZVJvb3QoKTtcclxuXHJcbiAgICBjb25zdCBlbnYgPSB0aGlzLmxvYWRFbnZpcm9ubWVudCgpO1xyXG5cclxuICAgIGNvbnN0IHVubW9jayA9IHRoaXMubG9hZFVzZXJuYW1lTW9jaygpO1xyXG5cclxuICAgIHJldHVybiBgJHtzdGF0ZVJvb3R9P2xjdS1hcHAtZW50LWxvb2t1cD0ke3RoaXMuU2V0dGluZ3MuQXBwbGljYXRpb24uRW50ZXJwcmlzZUxvb2t1cH0mbGN1LWVudmlyb25tZW50PSR7ZW52fSZsY3UtdXNlcm5hbWUtbW9jaz0ke3VubW9ja31gO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGxvYWRIdWJVcmwodXJsUm9vdDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBhcGlSb290ID0gdGhpcy5TZXR0aW5ncyA/IHRoaXMuU2V0dGluZ3MuQVBJUm9vdCB8fCAnJyA6ICcnO1xyXG5cclxuICAgIGNvbnN0IGh1YlBhdGggPSB0aGlzLmxvYWRIdWJQYXRoKCk7XHJcblxyXG4gICAgcmV0dXJuIGAke2FwaVJvb3R9JHt1cmxSb290IHx8ICcnfSR7aHViUGF0aH1gO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGFic3RyYWN0IGxvYWRTdGF0ZUtleSgpOiBzdHJpbmc7XHJcblxyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBsb2FkU3RhdGVOYW1lKCk6IHN0cmluZztcclxuXHJcbiAgcHJvdGVjdGVkIGxvYWRTdGF0ZVJvb3QoKSB7XHJcbiAgICBjb25zdCBzdGF0ZVJvb3QgPVxyXG4gICAgICB0aGlzLlNldHRpbmdzLlN0YXRlICYmIHRoaXMuU2V0dGluZ3MuU3RhdGUuUm9vdCAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgPyB0aGlzLlNldHRpbmdzLlN0YXRlLlJvb3RcclxuICAgICAgICA6ICcnO1xyXG5cclxuICAgIHJldHVybiBgJHtzdGF0ZVJvb3R9LyR7dGhpcy5sb2FkU3RhdGVOYW1lKCl9YDtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBsb2FkU3RhdGVBY3Rpb25Sb290KCkge1xyXG4gICAgY29uc3Qgc3RhdGVBY3RpblJvb3QgPVxyXG4gICAgICB0aGlzLlNldHRpbmdzLlN0YXRlICYmXHJcbiAgICAgIHRoaXMuU2V0dGluZ3MuU3RhdGUuQWN0aW9uUm9vdCAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgPyB0aGlzLlNldHRpbmdzLlN0YXRlLkFjdGlvblJvb3RcclxuICAgICAgICA6ICcnO1xyXG5cclxuICAgIHJldHVybiBgJHtzdGF0ZUFjdGluUm9vdH0vJHt0aGlzLmxvYWRTdGF0ZU5hbWUoKX1gO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGxvYWRVc2VybmFtZU1vY2soKSB7XHJcbiAgICByZXR1cm4gdGhpcy5TZXR0aW5ncy5TdGF0ZSAmJiB0aGlzLlNldHRpbmdzLlN0YXRlLlVzZXJuYW1lTW9ja1xyXG4gICAgICA/IHRoaXMuU2V0dGluZ3MuU3RhdGUuVXNlcm5hbWVNb2NrXHJcbiAgICAgIDogJyc7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgc2V0dXAoKSB7XHJcbiAgICB0aGlzLlN0YXJ0KGZhbHNlKS50aGVuKCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgc2V0dXBSZWNlaXZlU3RhdGUoZ3JvdXBOYW1lOiBzdHJpbmcpIHtcclxuICAgIHRoaXMucnQuUmVnaXN0ZXJIYW5kbGVyKGBSZWNlaXZlU3RhdGU9PiR7Z3JvdXBOYW1lfWApLnN1YnNjcmliZSgocmVxKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBIYW5kbGVkIHN0YXRlIGZyb20gJHtncm91cE5hbWV9YCk7XHJcblxyXG4gICAgICB0aGlzLnN1YmplY3QubmV4dChyZXEpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==