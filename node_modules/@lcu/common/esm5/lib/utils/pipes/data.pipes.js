import { Pipe } from '@angular/core';
import { DatePipe, DecimalPipe, PercentPipe } from '@angular/common';
import { DataPipeConstants } from '../constants/data-pipe.constants';
import { TemperatureConversion } from '../conversion/temperature.conversion';
import { TimezoneConversion } from '../conversion/timezone.conversion';
var DataPipes = /** @class */ (function () {
    function DataPipes() {
    }
    DataPipes.prototype.transform = function (val, arg) {
        if (!arg) {
            return val;
        }
        var format = arg.toLowerCase();
        /**
         * Return date M/d/YYYY
         */
        if (format === DataPipeConstants.PIPE_SHORTDATE) {
            var pipe = new DatePipe('en-US');
            var transformed = pipe.transform(val, DataPipeConstants.DATE_SHORTDATE);
            return transformed;
        }
        /**
         * Return date
         */
        if (format === DataPipeConstants.PIPE_DATE.toLowerCase()) {
            var pipe = new DatePipe('en-US');
            var transformed = pipe.transform(val, DataPipeConstants.DATE_FMT);
            return transformed;
        }
        /**
         * Return date MMM d, y
         */
        if (format === DataPipeConstants.PIPE_MEDIUMDATE.toLowerCase()) {
            var pipe = new DatePipe('en-US');
            var transformed = pipe.transform(val, 'MMM d, y');
            return transformed;
        }
        /**
         * Return date 'EEEE, MMMM d, y'
         */
        if (format === DataPipeConstants.PIPE_FULLDATE.toLowerCase()) {
            var pipe = new DatePipe('en-US');
            var transformed = pipe.transform(val, DataPipeConstants.DATE_FULLDATE);
            return transformed;
        }
        /**
         * Return MM/dd/yyyy hh:mm:ss a z
         */
        if (format === DataPipeConstants.DATE_TIME_ZONE_FMT.toLowerCase()) {
            var pipe = new DatePipe('en-US');
            var transformed = pipe.transform(val, DataPipeConstants.DATE_TIME_ZONE_FMT);
            var splittedString_1 = transformed.toString().split(' ');
            splittedString_1[splittedString_1.length - 1] = TimezoneConversion.GMTTimezoneConversion(splittedString_1[splittedString_1.length - 1]);
            var newDateString_1 = '';
            splittedString_1.forEach(function (st) {
                if (splittedString_1.indexOf(st) < splittedString_1.length - 1) {
                    newDateString_1 += st + ' ';
                }
                else {
                    newDateString_1 += st;
                }
            });
            return newDateString_1;
        }
        /**
         * Return date from epoch val
         */
        if (format === DataPipeConstants.PIPE_EPOCH.toLowerCase()) {
            var pipe = new DatePipe('en-US');
            var transformed = pipe.transform(val * 1000, DataPipeConstants.DATE_DAY_TIME);
            return transformed;
        }
        /**
         * Return number with decimal
         */
        if (format === DataPipeConstants.PIPE_NUMBER.toLowerCase()) {
            var pipe = new DecimalPipe('en-US');
            var transformed = pipe.transform(val, '1.0-0');
            return transformed;
        }
        /**
         * Return return number with mph appended
         */
        if (format === DataPipeConstants.PIPE_MPH.toLowerCase()) {
            var pipe = new DecimalPipe('en-US');
            var transformed = pipe.transform(val, '1.0-0');
            return transformed + ' mph';
        }
        /**
         * Return percentage
         */
        if (format === DataPipeConstants.PIPE_PERCENTAGE.toLowerCase()) {
            var pipe = new PercentPipe('en-US');
            var transformed = pipe.transform(val);
            return transformed;
        }
        /**
         * Return percentage
         */
        if (format === DataPipeConstants.PIPE_PERCENTAGE_DECIMAL.toLowerCase()) {
            var pipe = new PercentPipe('en-US');
            var transformed = pipe.transform(val, '2.2-2');
            return transformed;
        }
        /**
         * Return percentage with two decimals
         */
        if (format === DataPipeConstants.PIPE_DECIMAL_TWO.toLowerCase()) {
            var pipe = new DecimalPipe('en-US');
            var transformed = pipe.transform(val, '1.2-2');
            return transformed;
        }
        /**
         * Return percentage with four decimals
         */
        if (format === DataPipeConstants.PIPE_DECIMAL_FOUR.toLowerCase()) {
            var pipe = new DecimalPipe('en-US');
            var transformed = pipe.transform(val, '1.4-4');
            return transformed;
        }
        /**
         * Return temperature in fahrenheit, append °F
         */
        if (format === DataPipeConstants.PIPE_TEMP_FAHRENHEIT.toLowerCase()) {
            var pipe = new DecimalPipe('en-US');
            // const temperature = (val * 32) + 1.8;
            var transformed = pipe.transform(val, '1.0-0');
            return transformed + ' °F';
        }
        /**
         * Return temperature in kelvin, append °K
         */
        if (format === DataPipeConstants.PIPE_TEMP_KELVIN.toLowerCase()) {
            var pipe = new DecimalPipe('en-US');
            // const temperature = (val * 32) + 1.8;
            var temperature = TemperatureConversion.FahrenheitToKelvin(val);
            var transformed = pipe.transform(temperature, '1.0-0');
            return transformed + ' °K';
        }
        /**
         * Return temperature in celsius, append °C
         */
        if (format === DataPipeConstants.PIPE_TEMP_CELSIUS.toLowerCase()) {
            var pipe = new DecimalPipe('en-US');
            var temperature = TemperatureConversion.FahrenheitToCelsius(val);
            var transformed = pipe.transform(temperature, '1.0-0');
            return transformed + ' °C';
        }
        /**
         * retrun the string sliced down to 50
         */
        if (format === DataPipeConstants.PIPE_STRING_SLICE_FIFTY.toLowerCase()) {
            return val.slice(0, 50) + '...';
        }
        /**
         * retrun the string sliced down to 70
         */
        if (format === DataPipeConstants.PIPE_STRING_SLICE_SEVENTY.toLowerCase()) {
            return val.slice(0, 70) + '...';
        }
        /**
         * retrun the string sliced down to 100
         */
        if (format === DataPipeConstants.PIPE_STRING_SLICE_HUNDRED.toLowerCase()) {
            return val.slice(0, 100) + '...';
        }
        /**
         * Return password visibility
         */
        if (format === DataPipeConstants.PIPE_PASSWORD.toLowerCase()) {
            return '•'.repeat(val.length);
        }
        /**
         * IF none of the above work, return the original val
         */
        return val;
    };
    DataPipes.decorators = [
        { type: Pipe, args: [{
                    name: 'dataPipes'
                },] }
    ];
    return DataPipes;
}());
export { DataPipes };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS5waXBlcy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BsY3UvY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3V0aWxzL3BpcGVzL2RhdGEucGlwZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDcEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDckUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDckUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDN0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHdkU7SUFBQTtJQXdRQSxDQUFDO0lBclBDLDZCQUFTLEdBQVQsVUFBVSxHQUFRLEVBQUcsR0FBWTtRQUUvQixJQUFJLENBQUMsR0FBRyxFQUFFO1lBQ1IsT0FBTyxHQUFHLENBQUM7U0FDWjtRQUVELElBQU0sTUFBTSxHQUFXLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUV6Qzs7V0FFRztRQUNILElBQUksTUFBTSxLQUFLLGlCQUFpQixDQUFDLGNBQWMsRUFBRTtZQUUvQyxJQUFNLElBQUksR0FBRyxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVuQyxJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUUxRSxPQUFPLFdBQVcsQ0FBQztTQUNwQjtRQUVEOztXQUVHO1FBQ0gsSUFBSSxNQUFNLEtBQUssaUJBQWlCLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBRXhELElBQU0sSUFBSSxHQUFHLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRW5DLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMs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QUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUNqQztRQUVEOztXQUVHO1FBRUgsSUFBSSxNQUFNLEtBQUssaUJBQWlCLENBQUMseUJBQXlCLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDeEUsT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUM7U0FDakM7UUFFRDs7V0FFRztRQUVILElBQUksTUFBTSxLQUFLLGlCQUFpQixDQUFDLHlCQUF5QixDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQ3hFLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO1NBQ2xDO1FBRUQ7O1dBRUc7UUFDSCxJQUFJLE1BQU0sS0FBSyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDNUQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMvQjtRQUVEOztXQUVHO1FBQ0gsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDOztnQkF2UUYsSUFBSSxTQUFDO29CQUNKLElBQUksRUFBRSxXQUFXO2lCQUNsQjs7SUFzUUQsZ0JBQUM7Q0FBQSxBQXhRRCxJQXdRQztTQXZQWSxTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRlUGlwZSwgRGVjaW1hbFBpcGUsIFBlcmNlbnRQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgRGF0YVBpcGVDb25zdGFudHMgfSBmcm9tICcuLi9jb25zdGFudHMvZGF0YS1waXBlLmNvbnN0YW50cyc7XHJcbmltcG9ydCB7IFRlbXBlcmF0dXJlQ29udmVyc2lvbiB9IGZyb20gJy4uL2NvbnZlcnNpb24vdGVtcGVyYXR1cmUuY29udmVyc2lvbic7XHJcbmltcG9ydCB7IFRpbWV6b25lQ29udmVyc2lvbiB9IGZyb20gJy4uL2NvbnZlcnNpb24vdGltZXpvbmUuY29udmVyc2lvbic7XHJcblxyXG5cclxuQFBpcGUoe1xyXG4gIG5hbWU6ICdkYXRhUGlwZXMnXHJcbn0pXHJcblxyXG4vKipcclxuICogQ3VzdG9tIHRyYW5zZm9tcmF0aW9uIHBpcGVzXHJcbiAqXHJcbiAqIEBwYXJhbSB2YWwgdmFsdWUgdG8gYmUgcmV0dXJuZWQgdHJhbnNmb3JtZWRcclxuICogQHBhcmFtIGFyZyBhcmd1bWVudCBjb250YWluaW5nIGZvcm1hdCBzdHJpbmcgKCdkZC9NTU0veXl5eScpXHJcbiAqXHJcbiAqIEV4LlxyXG4gKiAvLyBjb25zdGFudHMgb3V0c2lkZSBvZiBhIGNvbXBvbmVudCBuZWVkIHRvIGJlIGFzc2lnbmVkXHJcbiAqIC8vIHRvIGEgbG9jYWwgcHJvcGVydHkgaW4gb3JkZXIgdG8gd29ya1xyXG4gKlxyXG4gKiBjb25zdCBkYXRlRm10OiBzdHJpbmcgPSBEYXRhUGlwZUNvbnN0YW50cy5EQVRFX0ZNVDtcclxuICogPHNwYW4+e3sgdmFsIHwgZGF0YVBpcGVzOmRhdGVGbXQgfX08L3NwYW4+XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRGF0YVBpcGVzIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XHJcblxyXG4gIHRyYW5zZm9ybSh2YWw6IGFueSAsIGFyZz86IHN0cmluZyk6IGFueSB7XHJcblxyXG4gICAgaWYgKCFhcmcpIHtcclxuICAgICAgcmV0dXJuIHZhbDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmb3JtYXQ6IHN0cmluZyA9IGFyZy50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIGRhdGUgTS9kL1lZWVlcclxuICAgICAqL1xyXG4gICAgaWYgKGZvcm1hdCA9PT0gRGF0YVBpcGVDb25zdGFudHMuUElQRV9TSE9SVERBVEUpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgRGF0YVBpcGVDb25zdGFudHMuREFURV9TSE9SVERBVEUpO1xyXG5cclxuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIGRhdGVcclxuICAgICAqL1xyXG4gICAgaWYgKGZvcm1hdCA9PT0gRGF0YVBpcGVDb25zdGFudHMuUElQRV9EQVRFLnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgRGF0YVBpcGVDb25zdGFudHMuREFURV9GTVQpO1xyXG5cclxuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIGRhdGUgTU1NIGQsIHlcclxuICAgICAqL1xyXG4gICAgaWYgKGZvcm1hdCA9PT0gRGF0YVBpcGVDb25zdGFudHMuUElQRV9NRURJVU1EQVRFLnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgJ01NTSBkLCB5Jyk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gZGF0ZSAnRUVFRSwgTU1NTSBkLCB5J1xyXG4gICAgICovXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5QSVBFX0ZVTExEQVRFLnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgRGF0YVBpcGVDb25zdGFudHMuREFURV9GVUxMREFURSk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybiBNTS9kZC95eXl5IGhoOm1tOnNzIGEgelxyXG4gICAgICovXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5EQVRFX1RJTUVfWk9ORV9GTVQudG9Mb3dlckNhc2UoKSkge1xyXG5cclxuICAgICAgY29uc3QgcGlwZSA9IG5ldyBEYXRlUGlwZSgnZW4tVVMnKTtcclxuXHJcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gcGlwZS50cmFuc2Zvcm0odmFsLCBEYXRhUGlwZUNvbnN0YW50cy5EQVRFX1RJTUVfWk9ORV9GTVQpO1xyXG5cclxuICAgICAgY29uc3Qgc3BsaXR0ZWRTdHJpbmcgPSB0cmFuc2Zvcm1lZC50b1N0cmluZygpLnNwbGl0KCcgJyk7XHJcblxyXG4gICAgICBzcGxpdHRlZFN0cmluZ1tzcGxpdHRlZFN0cmluZy5sZW5ndGggLSAxIF0gPSBUaW1lem9uZUNvbnZlcnNpb24uR01UVGltZXpvbmVDb252ZXJzaW9uKHNwbGl0dGVkU3RyaW5nW3NwbGl0dGVkU3RyaW5nLmxlbmd0aC0xXSk7XHJcblxyXG4gICAgICBsZXQgbmV3RGF0ZVN0cmluZzogc3RyaW5nID0gJyc7XHJcblxyXG4gICAgICBzcGxpdHRlZFN0cmluZy5mb3JFYWNoKChzdDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKHNwbGl0dGVkU3RyaW5nLmluZGV4T2Yoc3QpIDwgc3BsaXR0ZWRTdHJpbmcubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgbmV3RGF0ZVN0cmluZyArPSBzdCArICcgJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbmV3RGF0ZVN0cmluZyArPSBzdDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIG5ld0RhdGVTdHJpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gZGF0ZSBmcm9tIGVwb2NoIHZhbFxyXG4gICAgICovXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5QSVBFX0VQT0NILnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCAqIDEwMDAsIERhdGFQaXBlQ29uc3RhbnRzLkRBVEVfREFZX1RJTUUpO1xyXG5cclxuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIG51bWJlciB3aXRoIGRlY2ltYWxcclxuICAgICAqL1xyXG4gICAgaWYgKGZvcm1hdCA9PT0gRGF0YVBpcGVDb25zdGFudHMuUElQRV9OVU1CRVIudG9Mb3dlckNhc2UoKSkge1xyXG5cclxuICAgICAgY29uc3QgcGlwZSA9IG5ldyBEZWNpbWFsUGlwZSgnZW4tVVMnKTtcclxuXHJcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gcGlwZS50cmFuc2Zvcm0odmFsLCAnMS4wLTAnKTtcclxuXHJcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybiByZXR1cm4gbnVtYmVyIHdpdGggbXBoIGFwcGVuZGVkXHJcbiAgICAgKi9cclxuICAgIGlmIChmb3JtYXQgPT09IERhdGFQaXBlQ29uc3RhbnRzLlBJUEVfTVBILnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGVjaW1hbFBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgJzEuMC0wJyk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQgKyAnIG1waCc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gcGVyY2VudGFnZVxyXG4gICAgICovXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5QSVBFX1BFUkNFTlRBR0UudG9Mb3dlckNhc2UoKSkge1xyXG5cclxuICAgICAgY29uc3QgcGlwZSA9IG5ldyBQZXJjZW50UGlwZSgnZW4tVVMnKTtcclxuXHJcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gcGlwZS50cmFuc2Zvcm0odmFsKTtcclxuXHJcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybiBwZXJjZW50YWdlXHJcbiAgICAgKi9cclxuICAgIGlmIChmb3JtYXQgPT09IERhdGFQaXBlQ29uc3RhbnRzLlBJUEVfUEVSQ0VOVEFHRV9ERUNJTUFMLnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgUGVyY2VudFBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgJzIuMi0yJyk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gcGVyY2VudGFnZSB3aXRoIHR3byBkZWNpbWFsc1xyXG4gICAgICovXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5QSVBFX0RFQ0lNQUxfVFdPLnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGVjaW1hbFBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgJzEuMi0yJyk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gcGVyY2VudGFnZSB3aXRoIGZvdXIgZGVjaW1hbHNcclxuICAgICAqL1xyXG4gICAgaWYgKGZvcm1hdCA9PT0gRGF0YVBpcGVDb25zdGFudHMuUElQRV9ERUNJTUFMX0ZPVVIudG9Mb3dlckNhc2UoKSkge1xyXG5cclxuICAgICAgY29uc3QgcGlwZSA9IG5ldyBEZWNpbWFsUGlwZSgnZW4tVVMnKTtcclxuXHJcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gcGlwZS50cmFuc2Zvcm0odmFsLCAnMS40LTQnKTtcclxuXHJcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybiB0ZW1wZXJhdHVyZSBpbiBmYWhyZW5oZWl0LCBhcHBlbmQgwrBGXHJcbiAgICAgKi9cclxuICAgIGlmIChmb3JtYXQgPT09IERhdGFQaXBlQ29uc3RhbnRzLlBJUEVfVEVNUF9GQUhSRU5IRUlULnRvTG93ZXJDYXNlKCkpIHtcclxuXHJcbiAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRGVjaW1hbFBpcGUoJ2VuLVVTJyk7XHJcblxyXG4gICAgICAvLyBjb25zdCB0ZW1wZXJhdHVyZSA9ICh2YWwgKiAzMikgKyAxLjg7XHJcblxyXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZCA9IHBpcGUudHJhbnNmb3JtKHZhbCwgJzEuMC0wJyk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQgKyAnIMKwRic7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gdGVtcGVyYXR1cmUgaW4ga2VsdmluLCBhcHBlbmQgwrBLXHJcbiAgICAgKi9cclxuICAgIGlmIChmb3JtYXQgPT09IERhdGFQaXBlQ29uc3RhbnRzLlBJUEVfVEVNUF9LRUxWSU4udG9Mb3dlckNhc2UoKSkge1xyXG5cclxuICAgICAgY29uc3QgcGlwZSA9IG5ldyBEZWNpbWFsUGlwZSgnZW4tVVMnKTtcclxuXHJcbiAgICAgIC8vIGNvbnN0IHRlbXBlcmF0dXJlID0gKHZhbCAqIDMyKSArIDEuODtcclxuXHJcbiAgICAgIGNvbnN0IHRlbXBlcmF0dXJlID0gVGVtcGVyYXR1cmVDb252ZXJzaW9uLkZhaHJlbmhlaXRUb0tlbHZpbih2YWwpO1xyXG5cclxuICAgICAgY29uc3QgdHJhbnNmb3JtZWQgPSBwaXBlLnRyYW5zZm9ybSh0ZW1wZXJhdHVyZSwgJzEuMC0wJyk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQgKyAnIMKwSyc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gdGVtcGVyYXR1cmUgaW4gY2Vsc2l1cywgYXBwZW5kIMKwQ1xyXG4gICAgICovXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5QSVBFX1RFTVBfQ0VMU0lVUy50b0xvd2VyQ2FzZSgpKSB7XHJcblxyXG4gICAgICBjb25zdCBwaXBlID0gbmV3IERlY2ltYWxQaXBlKCdlbi1VUycpO1xyXG5cclxuICAgICAgY29uc3QgdGVtcGVyYXR1cmUgPSBUZW1wZXJhdHVyZUNvbnZlcnNpb24uRmFocmVuaGVpdFRvQ2Vsc2l1cyh2YWwpO1xyXG5cclxuICAgICAgY29uc3QgdHJhbnNmb3JtZWQgPSBwaXBlLnRyYW5zZm9ybSh0ZW1wZXJhdHVyZSwgJzEuMC0wJyk7XHJcblxyXG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQgKyAnIMKwQyc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiByZXRydW4gdGhlIHN0cmluZyBzbGljZWQgZG93biB0byA1MFxyXG4gICAgICovXHJcblxyXG4gICAgaWYgKGZvcm1hdCA9PT0gRGF0YVBpcGVDb25zdGFudHMuUElQRV9TVFJJTkdfU0xJQ0VfRklGVFkudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICByZXR1cm4gdmFsLnNsaWNlKDAsIDUwKSArICcuLi4nO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0cnVuIHRoZSBzdHJpbmcgc2xpY2VkIGRvd24gdG8gNzBcclxuICAgICAqL1xyXG5cclxuICAgIGlmIChmb3JtYXQgPT09IERhdGFQaXBlQ29uc3RhbnRzLlBJUEVfU1RSSU5HX1NMSUNFX1NFVkVOVFkudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICByZXR1cm4gdmFsLnNsaWNlKDAsIDcwKSArICcuLi4nO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0cnVuIHRoZSBzdHJpbmcgc2xpY2VkIGRvd24gdG8gMTAwXHJcbiAgICAgKi9cclxuXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5QSVBFX1NUUklOR19TTElDRV9IVU5EUkVELnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgcmV0dXJuIHZhbC5zbGljZSgwLCAxMDApICsgJy4uLic7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gcGFzc3dvcmQgdmlzaWJpbGl0eVxyXG4gICAgICovXHJcbiAgICBpZiAoZm9ybWF0ID09PSBEYXRhUGlwZUNvbnN0YW50cy5QSVBFX1BBU1NXT1JELnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgcmV0dXJuICfigKInLnJlcGVhdCh2YWwubGVuZ3RoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIElGIG5vbmUgb2YgdGhlIGFib3ZlIHdvcmssIHJldHVybiB0aGUgb3JpZ2luYWwgdmFsXHJcbiAgICAgKi9cclxuICAgIHJldHVybiB2YWw7XHJcbiAgfVxyXG59XHJcbiJdfQ==